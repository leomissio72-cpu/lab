
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Gestão - Restaurante</title>
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --success: #27ae60;
            --danger: #e74c3c;
            --warning: #f39c12;
        }
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        body {
            background-color: #f5f7fa;
            color: #333;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        header {
            background-color: var(--primary);
            color: white;
            padding: 15px 0;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .logo {
            font-size: 24px;
            font-weight: bold;
        }
        nav ul {
            display: flex;
            list-style: none;
        }
        nav ul li {
            margin-left: 20px;
        }
        nav ul li a {
            color: white;
            text-decoration: none;
            padding: 5px 10px;
            border-radius: 4px;
            transition: background-color 0.3s;
        }
        nav ul li a:hover, nav ul li a.active {
            background-color: rgba(255,255,255,0.1);
        }
        .card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 20px;
            margin-bottom: 20px;
        }
        h1, h2 {
            margin-bottom: 15px;
            color: var(--primary);
        }
        .btn {
            padding: 8px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }
        .btn-primary {
            background-color: var(--secondary);
            color: white;
        }
        .btn-success {
            background-color: var(--success);
            color: white;
        }
        .btn-danger {
            background-color: var(--danger);
            color: white;
        }
        .btn:hover {
            opacity: 0.9;
            transform: translateY(-2px);
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input, select, textarea {
            width: 100%;
            padding: 8px 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .section {
            display: none;
        }
        .section.active {
            display: block;
        }
        .alert {
            padding: 10px 15px;
            border-radius: 4px;
            margin-bottom: 15px;
        }
        .alert-success {
            background-color: #d4edda;
            color: #155724;
        }
        .alert-danger {
            background-color: #f8d7da;
            color: #721c24;
        }
        .hidden {
            display: none;
        }
        .loading {
            text-align: center;
            padding: 20px;
            color: var(--secondary);
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        th {
            background-color: #f8f9fa;
            font-weight: bold;
        }
        .dashboard-stats {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        .stat-card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            padding: 15px;
            text-align: center;
        }
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: var(--secondary);
        }
        .stat-label {
            font-size: 14px;
            color: #777;
        }
    </style>
</head>
<body>
    <header>
        <div class="container header-content">
            <div class="logo">Sistema Restaurante</div>
            <nav>
                <ul>
                    <li><a href="#" class="nav-link active" data-section="dashboard">Dashboard</a></li>
                    <li><a href="#" class="nav-link" data-section="produtos">Produtos</a></li>
                    <li><a href="#" class="nav-link" data-section="comandas">Comandas</a></li>
                    <li><a href="#" class="nav-link" data-section="relatorios">Relatórios</a></li>
                    <li><a href="#" class="nav-link" data-section="configuracoes">Configurações</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <div class="container">
        <!-- Dashboard -->
        <section id="dashboard" class="section active">
            <h1>Dashboard</h1>
            <div class="dashboard-stats">
                <div class="stat-card">
                    <div class="stat-value" id="total-vendas">R$ 0,00</div>
                    <div class="stat-label">Total em Vendas</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="total-comandas">0</div>
                    <div class="stat-label">Comandas Ativas</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="total-produtos">0</div>
                    <div class="stat-label">Produtos Cadastrados</div>
                </div>
            </div>
        </section>

        <!-- Produtos -->
        <section id="produtos" class="section">
            <h1>Gerenciar Produtos</h1>
            <div class="card">
                <div class="alert alert-success hidden" id="produto-success"></div>
                <div class="alert alert-danger hidden" id="produto-error"></div>
                <div class="form-group">
                    <label>Nome do Produto</label>
                    <input type="text" id="nome-produto">
                </div>
                <div class="form-group">
                    <label>Categoria</label>
                    <select id="categoria">
                        <option value="">Selecione</option>
                        <option value="Espeto">Espeto</option>
                        <option value="Bebidas">Bebidas</option>
                        <option value="Copos">Copos</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Preço (R$)</label>
                    <input type="number" id="preco" step="0.01">
                </div>
                <div class="form-group">
                    <label>Descrição</label>
                    <textarea id="descricao" rows="3"></textarea>
                </div>
                <button class="btn btn-primary" id="adicionar-produto">Adicionar Produto</button>
            </div>
            <div class="card">
                <h2>Produtos Cadastrados</h2>
                <div id="loading-produtos" class="loading hidden">Carregando...</div>
                <table id="tabela-produtos">
                    <thead>
                        <tr>
                            <th>Nome</th>
                            <th>Categoria</th>
                            <th>Preço</th>
                            <th>Ações</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </section>

        <!-- Comandas -->
        <section id="comandas" class="section">
            <h1>Gerenciar Comandas</h1>
            <div class="card">
                <div class="alert alert-success hidden" id="comanda-success"></div>
                <div class="form-group">
                    <label>Nome do Cliente</label>
                    <input type="text" id="cliente">
                </div>
                <button class="btn btn-primary" id="criar-comanda">Criar Nova Comanda</button>
            </div>
            <div class="card">
                <h2>Comandas Ativas</h2>
                <div id="loading-comandas" class="loading hidden">Carregando...</div>
                <div id="comandas-lista"></div>
            </div>
        </section>

        <!-- Relatórios -->
        <section id="relatorios" class="section">
            <h1>Relatórios de Vendas</h1>
            <div class="card">
                <div class="form-group">
                    <label>Data Início</label>
                    <input type="date" id="data-inicio">
                </div>
                <div class="form-group">
                    <label>Data Fim</label>
                    <input type="date" id="data-fim">
                </div>
                <button class="btn btn-primary" id="filtrar-relatorio">Filtrar</button>
            </div>
            <div class="card">
                <h2>Vendas</h2>
                <div id="loading-vendas" class="loading hidden">Carregando...</div>
                <table id="tabela-vendas">
                    <thead>
                        <tr>
                            <th>Data</th>
                            <th>Cliente</th>
                            <th>Total</th>
                            <th>Pagamento</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </section>

        <!-- Configurações -->
        <section id="configuracoes" class="section">
            <h1>Configurações</h1>
            <div class="card">
                <div class="alert alert-success hidden" id="config-success"></div>
                <div class="form-group">
                    <label>URL do Google Apps Script</label>
                    <input type="text" id="sheets-url" placeholder="https://script.google.com/macros/s/...">
                    <small>Cole aqui a URL de implantação do seu Google Apps Script</small>
                </div>
                <button class="btn btn-primary" id="salvar-config">Salvar Configurações</button>
                <button class="btn btn-success" id="testar-conexao">Testar Conexão</button>
            </div>
        </section>
    </div>

    <script>
        // Variável global para a URL do Google Apps Script
        let SCRIPT_URL = '';

        // Carregar configuração ao iniciar
        function carregarConfig() {
            const config = localStorage.getItem('sheetsConfig');
            if (config) {
                const { sheetsUrl } = JSON.parse(config);
                SCRIPT_URL = sheetsUrl;
                document.getElementById('sheets-url').value = sheetsUrl;
            }
        }

        // Salvar configuração
        document.getElementById('salvar-config').addEventListener('click', function() {
            const sheetsUrl = document.getElementById('sheets-url').value.trim();
            if (!sheetsUrl) {
                alert('Por favor, insira a URL do Google Apps Script');
                return;
            }
            localStorage.setItem('sheetsConfig', JSON.stringify({ sheetsUrl }));
            SCRIPT_URL = sheetsUrl;
            mostrarAlerta('config-success', 'Configurações salvas com sucesso!');
        });

        // Testar conexão
        document.getElementById('testar-conexao').addEventListener('click', async function() {
            if (!SCRIPT_URL) {
                alert('Configure a URL primeiro');
                return;
            }
            try {
                const response = await fetch(`${SCRIPT_URL}?acao=testar`);
                const data = await response.json();
                if (data.sucesso) {
                    alert('✅ Conexão estabelecida com sucesso!');
                } else {
                    alert('❌ Erro na conexão: ' + data.mensagem);
                }
            } catch (error) {
                alert('❌ Erro ao conectar: ' + error.message);
            }
        });

        // ========== PRODUTOS ==========
        document.getElementById('adicionar-produto').addEventListener('click', async function() {
            if (!SCRIPT_URL) {
                alert('Configure a URL do Google Apps Script primeiro');
                return;
            }

            const produto = {
                nome: document.getElementById('nome-produto').value,
                categoria: document.getElementById('categoria').value,
                preco: parseFloat(document.getElementById('preco').value),
                descricao: document.getElementById('descricao').value
            };

            if (!produto.nome || !produto.categoria || !produto.preco) {
                alert('Preencha todos os campos obrigatórios');
                return;
            }

            try {
                const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    body: JSON.stringify({ acao: 'salvarProduto', produto })
                });
                const data = await response.json();

                if (data.sucesso) {
                    mostrarAlerta('produto-success', 'Produto salvo com sucesso!');
                    document.getElementById('nome-produto').value = '';
                    document.getElementById('categoria').value = '';
                    document.getElementById('preco').value = '';
                    document.getElementById('descricao').value = '';
                    carregarProdutos();
                } else {
                    mostrarAlerta('produto-error', 'Erro: ' + data.mensagem);
                }
            } catch (error) {
                mostrarAlerta('produto-error', 'Erro ao salvar: ' + error.message);
            }
        });

        async function carregarProdutos() {
            if (!SCRIPT_URL) return;

            document.getElementById('loading-produtos').classList.remove('hidden');
            try {
                const response = await fetch(`${SCRIPT_URL}?acao=listarProdutos`);
                const data = await response.json();

                const tbody = document.querySelector('#tabela-produtos tbody');
                tbody.innerHTML = '';

                if (data.produtos && data.produtos.length > 0) {
                    data.produtos.forEach(produto => {
                        const tr = document.createElement('tr');
                        tr.innerHTML = `
                            <td>${produto.nome}</td>
                            <td>${produto.categoria}</td>
                            <td>R$ ${produto.preco.toFixed(2)}</td>
                            <td>
                                <button class="btn btn-danger" onclick="excluirProduto('${produto.id}')">Excluir</button>
                            </td>
                        `;
                        tbody.appendChild(tr);
                    });
                }
            } catch (error) {
                console.error('Erro ao carregar produtos:', error);
            } finally {
                document.getElementById('loading-produtos').classList.add('hidden');
            }
        }

        window.excluirProduto = async function(id) {
            if (!confirm('Deseja realmente excluir este produto?')) return;

            try {
                const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    body: JSON.stringify({ acao: 'excluirProduto', id })
                });
                const data = await response.json();

                if (data.sucesso) {
                    carregarProdutos();
                } else {
                    alert('Erro: ' + data.mensagem);
                }
            } catch (error) {
                alert('Erro ao excluir: ' + error.message);
            }
        };

        // ========== COMANDAS ==========
        document.getElementById('criar-comanda').addEventListener('click', async function() {
            if (!SCRIPT_URL) {
                alert('Configure a URL do Google Apps Script primeiro');
                return;
            }

            const cliente = document.getElementById('cliente').value;

            const comanda = {
                cliente: cliente || 'Não informado',
                itens: []
            };

            try {
                const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    body: JSON.stringify({ acao: 'salvarComanda', comanda })
                });
                const data = await response.json();

                if (data.sucesso) {
                    mostrarAlerta('comanda-success', 'Comanda criada com sucesso!');
                    document.getElementById('cliente').value = '';
                    carregarComandas();
                } else {
                    alert('Erro: ' + data.mensagem);
                }
            } catch (error) {
                alert('Erro ao criar comanda: ' + error.message);
            }
        });

        async function carregarComandas() {
            if (!SCRIPT_URL) return;

            document.getElementById('loading-comandas').classList.remove('hidden');
            try {
                const response = await fetch(`${SCRIPT_URL}?acao=listarComandas`);
                const data = await response.json();

                const lista = document.getElementById('comandas-lista');
                lista.innerHTML = '';

                if (data.comandas && data.comandas.length > 0) {
                    data.comandas.forEach(comanda => {
                        const div = document.createElement('div');
                        div.className = 'card';
                        div.innerHTML = `
                            <h3>Comanda #${comanda.id}</h3>
                            <p><strong>Cliente:</strong> ${comanda.cliente}</p>
                            <p><strong>Itens:</strong> ${comanda.itens.length}</p>
                            <button class="btn btn-success" onclick="fecharComanda('${comanda.id}', '${comanda.cliente}', ${comanda.itens.length})">Fechar Comanda</button>
                            <button class="btn btn-danger" onclick="excluirComanda('${comanda.id}')">Cancelar</button>
                        `;
                        lista.appendChild(div);
                    });
                } else {
                    lista.innerHTML = '<p>Nenhuma comanda ativa</p>';
                }
            } catch (error) {
                console.error('Erro ao carregar comandas:', error);
            } finally {
                document.getElementById('loading-comandas').classList.add('hidden');
            }
        }

        window.fecharComanda = async function(comandaId, cliente, qtdItens) {
            const total = prompt('Digite o valor total da comanda:');
            if (!total) return;

            const formaPagamento = prompt('Forma de pagamento (dinheiro/pix/debito/credito):');
            if (!formaPagamento) return;

            const venda = {
                id: 'V_' + Date.now(),
                comandaId,
                cliente,
                data: new Date().toISOString(),
                total: parseFloat(total),
                formaPagamento,
                itens: [] // Simplificado para este exemplo
            };

            try {
                const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    body: JSON.stringify({ acao: 'salvarVenda', venda })
                });
                const data = await response.json();

                if (data.sucesso) {
                    alert('Venda registrada com sucesso!');
                    carregarComandas();
                    atualizarDashboard();
                } else {
                    alert('Erro: ' + data.mensagem);
                }
            } catch (error) {
                alert('Erro ao fechar comanda: ' + error.message);
            }
        };

        window.excluirComanda = async function(id) {
            if (!confirm('Deseja realmente cancelar esta comanda?')) return;

            try {
                const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    body: JSON.stringify({ acao: 'excluirComanda', id })
                });
                const data = await response.json();

                if (data.sucesso) {
                    carregarComandas();
                } else {
                    alert('Erro: ' + data.mensagem);
                }
            } catch (error) {
                alert('Erro ao excluir: ' + error.message);
            }
        };

        // ========== RELATÓRIOS ==========
        document.getElementById('filtrar-relatorio').addEventListener('click', carregarVendas);

        async function carregarVendas() {
            if (!SCRIPT_URL) return;

            const dataInicio = document.getElementById('data-inicio').value;
            const dataFim = document.getElementById('data-fim').value;

            document.getElementById('loading-vendas').classList.remove('hidden');
            try {
                const response = await fetch(`${SCRIPT_URL}?acao=listarVendas&dataInicio=${dataInicio}&dataFim=${dataFim}`);
                const data = await response.json();

                const tbody = document.querySelector('#tabela-vendas tbody');
                tbody.innerHTML = '';

                if (data.vendas && data.vendas.length > 0) {
                    data.vendas.forEach(venda => {
                        const tr = document.createElement('tr');
                        tr.innerHTML = `
                            <td>${venda.data}</td>
                            <td>${venda.cliente}</td>
                            <td>R$ ${venda.total.toFixed(2)}</td>
                            <td>${venda.formaPagamento}</td>
                        `;
                        tbody.appendChild(tr);
                    });
                } else {
                    tbody.innerHTML = '<tr><td colspan="4" style="text-align:center">Nenhuma venda encontrada</td></tr>';
                }
            } catch (error) {
                console.error('Erro ao carregar vendas:', error);
            } finally {
                document.getElementById('loading-vendas').classList.add('hidden');
            }
        }

        // ========== DASHBOARD ==========
        async function atualizarDashboard() {
            if (!SCRIPT_URL) return;

            try {
                // Carregar produtos
                const respProdutos = await fetch(`${SCRIPT_URL}?acao=listarProdutos`);
                const dataProdutos = await respProdutos.json();
                document.getElementById('total-produtos').textContent = dataProdutos.produtos?.length || 0;

                // Carregar comandas
                const respComandas = await fetch(`${SCRIPT_URL}?acao=listarComandas`);
                const dataComandas = await respComandas.json();
                document.getElementById('total-comandas').textContent = dataComandas.comandas?.length || 0;

                // Carregar vendas
                const respVendas = await fetch(`${SCRIPT_URL}?acao=listarVendas`);
                const dataVendas = await respVendas.json();
                const totalVendas = dataVendas.vendas?.reduce((sum, v) => sum + v.total, 0) || 0;
                document.getElementById('total-vendas').textContent = `R$ ${totalVendas.toFixed(2)}`;
            } catch (error) {
                console.error('Erro ao atualizar dashboard:', error);
            }
        }

        // ========== NAVEGAÇÃO ==========
        document.querySelectorAll('.nav-link').forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
                this.classList.add('active');

                document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
                document.getElementById(this.dataset.section).classList.add('active');
            });
        });

        // ========== FUNÇÕES AUXILIARES ==========
        function mostrarAlerta(id, mensagem) {
            const alerta = document.getElementById(id);
            alerta.textContent = mensagem;
            alerta.classList.remove('hidden');
            setTimeout(() => alerta.classList.add('hidden'), 5000);
        }

        // ========== INICIALIZAÇÃO ==========
        document.addEventListener('DOMContentLoaded', function() {
            carregarConfig();
            if (SCRIPT_URL) {
                carregarProdutos();
                carregarComandas();
                atualizarDashboard();
            }
        });
    </script>
</body>
</html>
