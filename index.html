<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lista de Compras Inteligente - Controle de Gastos</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* RESET E CONFIGURA√á√ïES GERAIS */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            color: #333;
            line-height: 1.6;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1300px;
            margin: 0 auto;
            background-color: white;
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            position: relative;
        }

        /* HEADER */
        header {
            background: linear-gradient(135deg, #4b6cb7 0%, #182848 100%);
            color: white;
            padding: 40px 30px 30px;
            text-align: center;
            position: relative;
        }

        .dashboard-link {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            padding: 12px 25px;
            border-radius: 50px;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        .dashboard-link:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        header h1 {
            font-size: 2.8rem;
            margin-bottom: 10px;
            text-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
            max-width: 800px;
            margin: 0 auto;
        }

        /* APP CONTAINER */
        .app-container {
            padding: 35px;
            display: grid;
            grid-template-columns: 1fr 1.5fr;
            gap: 35px;
        }

        @media (max-width: 1100px) {
            .app-container {
                grid-template-columns: 1fr;
            }
        }

        /* FORM SECTION */
        .form-section {
            background: linear-gradient(145deg, #ffffff, #f0f0f0);
            padding: 30px;
            border-radius: 18px;
            box-shadow: 8px 8px 16px #d9d9d9, -8px -8px 16px #ffffff;
            border-left: 6px solid #4b6cb7;
        }

        .form-section h2 {
            color: #182848;
            margin-bottom: 25px;
            font-size: 1.7rem;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .form-group {
            margin-bottom: 25px;
            position: relative;
        }

        .form-row {
            display: flex;
            gap: 20px;
            margin-bottom: 5px;
        }

        .form-row .form-group {
            flex: 1;
        }

        label {
            display: block;
            margin-bottom: 10px;
            font-weight: 700;
            color: #444;
            font-size: 1.05rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        input {
            width: 100%;
            padding: 15px 20px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            font-size: 1.05rem;
            transition: all 0.3s;
            background: #f9f9f9;
        }

        input:focus {
            border-color: #4b6cb7;
            background: white;
            outline: none;
            box-shadow: 0 0 0 3px rgba(75, 108, 183, 0.2);
        }

        /* BUTTONS */
        button {
            cursor: pointer;
            border: none;
            border-radius: 12px;
            padding: 15px 25px;
            font-weight: 700;
            font-size: 1.1rem;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .btn-add {
            background: linear-gradient(135deg, #4b6cb7 0%, #3a5ca9 100%);
            color: white;
            width: 100%;
            font-size: 1.2rem;
            padding: 18px;
            margin-top: 10px;
        }

        .btn-add:hover {
            background: linear-gradient(135deg, #3a5ca9 0%, #2a4c99 100%);
            transform: translateY(-3px);
            box-shadow: 0 7px 15px rgba(75, 108, 183, 0.4);
        }

        .btn-clear {
            background: linear-gradient(135deg, #ff6b6b 0%, #ff5252 100%);
            color: white;
        }

        .btn-clear:hover {
            background: linear-gradient(135deg, #ff5252 0%, #ff3838 100%);
            transform: translateY(-2px);
            box-shadow: 0 5px 12px rgba(255, 107, 107, 0.4);
        }

        .btn-edit {
            background: linear-gradient(135deg, #51cf66 0%, #40c057 100%);
            color: white;
        }

        .btn-edit:hover {
            background: linear-gradient(135deg, #40c057 0%, #2fa84f 100%);
            transform: translateY(-2px);
        }

        .btn-delete {
            background: linear-gradient(135deg, #ff6b6b 0%, #ff5252 100%);
            color: white;
        }

        .btn-delete:hover {
            background: linear-gradient(135deg, #ff5252 0%, #ff3838 100%);
            transform: translateY(-2px);
        }

        .btn-export {
            background: linear-gradient(135deg, #4b6cb7 0%, #3a5ca9 100%);
            color: white;
        }

        .btn-export:hover {
            background: linear-gradient(135deg, #3a5ca9 0%, #2a4c99 100%);
            transform: translateY(-2px);
        }

        .btn-import {
            background: linear-gradient(135deg, #9c36b5 0%, #862e9c 100%);
            color: white;
        }

        .btn-import:hover {
            background: linear-gradient(135deg, #862e9c 0%, #702584 100%);
            transform: translateY(-2px);
        }

        /* STATS SECTION */
        .stats-section {
            margin-bottom: 30px;
        }

        .stats-section h2 {
            color: #182848;
            margin-bottom: 25px;
            font-size: 1.7rem;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .stats-cards {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-bottom: 25px;
        }

        @media (max-width: 768px) {
            .stats-cards {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 480px) {
            .stats-cards {
                grid-template-columns: 1fr;
            }
        }

        .stat-card {
            padding: 25px 20px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.08);
            transition: transform 0.3s;
            position: relative;
            overflow: hidden;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
        }

        .total::before { background: linear-gradient(90deg, #4b6cb7, #3a5ca9); }
        .highest::before { background: linear-gradient(90deg, #ff6b6b, #ff5252); }
        .lowest::before { background: linear-gradient(90deg, #51cf66, #40c057); }
        .count::before { background: linear-gradient(90deg, #9c36b5, #862e9c); }

        .stat-card h3 {
            font-size: 0.95rem;
            margin-bottom: 10px;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .stat-card p {
            font-size: 2.2rem;
            font-weight: 800;
            color: #182848;
        }

        /* LIST SECTION */
        .list-section {
            background: linear-gradient(145deg, #ffffff, #f0f0f0);
            padding: 30px;
            border-radius: 18px;
            box-shadow: 8px 8px 16px #d9d9d9, -8px -8px 16px #ffffff;
            border-left: 6px solid #9c36b5;
        }

        .list-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .list-section h2 {
            color: #182848;
            font-size: 1.7rem;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .table-container {
            overflow-x: auto;
            margin-bottom: 30px;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            border: 1px solid #eaeaea;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background-color: white;
            min-width: 800px;
        }

        thead {
            background: linear-gradient(135deg, #4b6cb7 0%, #3a5ca9 100%);
            color: white;
        }

        th {
            padding: 20px 15px;
            text-align: left;
            font-weight: 700;
            font-size: 1.05rem;
        }

        td {
            padding: 18px 15px;
            text-align: left;
            border-bottom: 1px solid #f0f0f0;
        }

        tbody tr {
            transition: background-color 0.2s;
        }

        tbody tr:hover {
            background-color: #f8faff;
        }

        tbody tr:nth-child(even) {
            background-color: #f9f9f9;
        }

        tbody tr:nth-child(even):hover {
            background-color: #f0f4ff;
        }

        .empty-row td {
            text-align: center;
            color: #888;
            font-style: italic;
            padding: 40px;
            font-size: 1.1rem;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
        }

        .action-buttons button {
            padding: 10px 15px;
            font-size: 0.9rem;
            border-radius: 8px;
        }

        /* EXPORT SECTION */
        .export-section {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }

        /* FOOTER */
        footer {
            text-align: center;
            padding: 25px;
            background: #f8f9fa;
            color: #666;
            border-top: 1px solid #eee;
            margin-top: 20px;
        }

        footer p {
            margin: 5px 0;
        }

        .footer-links {
            margin-top: 15px;
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        .footer-links a {
            color: #4b6cb7;
            text-decoration: none;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .footer-links a:hover {
            text-decoration: underline;
        }

        /* ANIMA√á√ïES */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .form-section, .list-section, .stat-card {
            animation: fadeIn 0.5s ease-out;
        }

        /* LOADING */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* TIPS */
        .tips {
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            padding: 15px 20px;
            border-radius: 12px;
            margin-top: 25px;
            border-left: 5px solid #2196f3;
        }

        .tips h3 {
            color: #0d47a1;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .tips ul {
            list-style-type: none;
            padding-left: 10px;
        }

        .tips li {
            margin-bottom: 8px;
            display: flex;
            align-items: flex-start;
            gap: 10px;
        }

        .tips li:before {
            content: "‚úì";
            color: #2196f3;
            font-weight: bold;
        }

        /* SCROLLBAR */
        ::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 5px;
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #4b6cb7 0%, #3a5ca9 100%);
            border-radius: 5px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, #3a5ca9 0%, #2a4c99 100%);
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-shopping-cart"></i> Lista de Compras Inteligente</h1>
            <p class="subtitle">Controle seus gastos, economize dinheiro e visualize onde voc√™ pode economizar mais</p>
            <a href="dashboard.html" class="dashboard-link">
                <i class="fas fa-chart-bar"></i> Ver Dashboard de Gastos
            </a>
        </header>

        <div class="app-container">
            <!-- FORMUL√ÅRIO DE ADI√á√ÉO -->
            <div class="form-section">
                <h2><i class="fas fa-plus-circle"></i> Adicionar Novo Produto</h2>
                <form id="product-form">
                    <div class="form-group">
                        <label for="product-name"><i class="fas fa-tag"></i> Nome do Produto:</label>
                        <input type="text" id="product-name" placeholder="Ex: Arroz, Leite, Carne, Shampoo..." required>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="product-quantity"><i class="fas fa-balance-scale"></i> Quantidade:</label>
                            <input type="number" id="product-quantity" min="1" value="1" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="product-price"><i class="fas fa-dollar-sign"></i> Valor Unit√°rio (R$):</label>
                            <input type="number" id="product-price" min="0.01" step="0.01" placeholder="0.00" required>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="product-category"><i class="fas fa-filter"></i> Categoria (opcional):</label>
                        <select id="product-category">
                            <option value="">Selecione uma categoria</option>
                            <option value="alimentacao">Alimenta√ß√£o</option>
                            <option value="limpeza">Limpeza</option>
                            <option value="higiene">Higiene Pessoal</option>
                            <option value="bebidas">Bebidas</option>
                            <option value="mercearia">Mercearia</option>
                            <option value="outros">Outros</option>
                        </select>
                    </div>
                    
                    <button type="submit" class="btn-add" id="submit-btn">
                        <i class="fas fa-cart-plus"></i> Adicionar √† Lista
                    </button>
                </form>

                <div class="tips">
                    <h3><i class="fas fa-lightbulb"></i> Dicas para economizar:</h3>
                    <ul>
                        <li>Compare pre√ßos de diferentes marcas</li>
                        <li>Compre em maior quantidade itens n√£o perec√≠veis</li>
                        <li>Use o dashboard para identificar seus maiores gastos</li>
                    </ul>
                </div>
            </div>

            <!-- CONTE√öDO PRINCIPAL -->
            <div>
                <!-- ESTAT√çSTICAS -->
                <div class="stats-section">
                    <h2><i class="fas fa-chart-line"></i> Resumo dos Gastos</h2>
                    <div class="stats-cards">
                        <div class="stat-card total">
                            <h3>Total Gasto</h3>
                            <p id="total-spent">R$ 0,00</p>
                        </div>
                        <div class="stat-card highest">
                            <h3>Maior Gasto</h3>
                            <p id="highest-spent">R$ 0,00</p>
                        </div>
                        <div class="stat-card lowest">
                            <h3>Menor Gasto</h3>
                            <p id="lowest-spent">R$ 0,00</p>
                        </div>
                        <div class="stat-card count">
                            <h3>Itens na Lista</h3>
                            <p id="item-count">0</p>
                        </div>
                    </div>
                </div>

                <!-- LISTA DE PRODUTOS -->
                <div class="list-section">
                    <div class="list-header">
                        <h2><i class="fas fa-list-check"></i> Itens da Lista de Compras</h2>
                        <button id="clear-all" class="btn-clear">
                            <i class="fas fa-trash"></i> Limpar Tudo
                        </button>
                    </div>
                    
                    <div class="table-container">
                        <table id="shopping-list">
                            <thead>
                                <tr>
                                    <th>Produto</th>
                                    <th>Quantidade</th>
                                    <th>Valor Unit√°rio</th>
                                    <th>Total Item</th>
                                    <th>A√ß√µes</th>
                                </tr>
                            </thead>
                            <tbody id="list-body">
                                <tr class="empty-row">
                                    <td colspan="5">Sua lista est√° vazia. Adicione produtos para come√ßar!</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="export-section">
                        <button id="export-btn" class="btn-export">
                            <i class="fas fa-download"></i> Exportar Lista (JSON)
                        </button>
                        <button id="import-btn" class="btn-import">
                            <i class="fas fa-upload"></i> Importar Lista
                        </button>
                        <input type="file" id="import-file" accept=".json" style="display: none;">
                        <button id="print-btn" class="btn-export" onclick="window.print()">
                            <i class="fas fa-print"></i> Imprimir
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <footer>
            <p>Lista de Compras Inteligente &copy; 2024 - Todos os dados s√£o salvos automaticamente no seu navegador</p>
            <p>Para usar no celular, adicione esta p√°gina √† tela inicial do seu dispositivo</p>
            <div class="footer-links">
                <a href="dashboard.html"><i class="fas fa-chart-bar"></i> Dashboard de Gastos</a>
                <a href="#" id="backup-link"><i class="fas fa-save"></i> Fazer Backup</a>
                <a href="#" id="restore-link"><i class="fas fa-history"></i> Restaurar Dados</a>
                <a href="#" id="help-link"><i class="fas fa-question-circle"></i> Ajuda</a>
            </div>
        </footer>
    </div>

    <script>
        // ========== INICIALIZA√á√ÉO ==========
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Lista de Compras Inteligente iniciada!');
            
            // Elementos do DOM
            const productForm = document.getElementById('product-form');
            const productName = document.getElementById('product-name');
            const productQuantity = document.getElementById('product-quantity');
            const productPrice = document.getElementById('product-price');
            const productCategory = document.getElementById('product-category');
            const listBody = document.getElementById('list-body');
            const totalSpentElement = document.getElementById('total-spent');
            const highestSpentElement = document.getElementById('highest-spent');
            const lowestSpentElement = document.getElementById('lowest-spent');
            const itemCountElement = document.getElementById('item-count');
            const clearAllButton = document.getElementById('clear-all');
            const exportButton = document.getElementById('export-btn');
            const importButton = document.getElementById('import-btn');
            const importFile = document.getElementById('import-file');
            const submitBtn = document.getElementById('submit-btn');
            const backupLink = document.getElementById('backup-link');
            const restoreLink = document.getElementById('restore-link');
            const helpLink = document.getElementById('help-link');

            // Carregar lista do localStorage
            let shoppingList = JSON.parse(localStorage.getItem('shoppingList')) || [];
            
            // Adicionar timestamp aos itens existentes (para compatibilidade)
            shoppingList = shoppingList.map(item => {
                if (!item.id) {
                    item.id = Date.now() + Math.random();
                }
                if (!item.date) {
                    item.date = new Date().toISOString();
                }
                if (!item.category) {
                    item.category = autoCategorizeProduct(item.name);
                }
                return item;
            });

            // ========== FUN√á√ïES AUXILIARES ==========
            function autoCategorizeProduct(productName) {
                const name = productName.toLowerCase();
                
                const categories = {
                    'alimentacao': ['arroz', 'feij√£o', 'feijao', 'macarr√£o', 'macarrao', 'carne', 'frango', 'peixe', 'leite', 'ovo', 'ovos', 'queijo', 'manteiga', 'a√ß√∫car', 'acucar', 'caf√©', 'cafe', '√≥leo', 'oleo', 'sal', 'farinha', 'biscoito', 'bolacha', 'p√£o', 'pao'],
                    'limpeza': ['sab√£o', 'sabao', 'detergente', '√°gua sanit√°ria', 'agua sanitaria', 'desinfetante', 'esponja', 'pano', 'sab√£o em p√≥', 'sabao em po', 'amaciante', '√°lcool', 'alcool', 'limpa vidros', 'lustra m√≥veis', 'inseticida', 'papel higi√™nico', 'papel higienico', 'papel toalha', 'saco de lixo'],
                    'higiene': ['shampoo', 'condicionador', 'sabonete', 'creme dental', 'pasta de dente', 'escova de dente', 'fio dental', 'desodorante', 'creme', 'protetor solar', 'absorvente', 'fralda', 'l√¢mina', 'lamina', 'espuma'],
                    'bebidas': ['refrigerante', 'suco', '√°gua', 'agua', 'cerveja', 'vinho', 'whisky', 'vodka', 'energ√©tico', 'energetico'],
                    'mercearia': ['farinha', 'fermento', 'a√ß√∫car', 'acucar', 'sal', 'tempero', 'molho', 'conserva', 'enlatado']
                };
                
                for (const [category, keywords] of Object.entries(categories)) {
                    for (const keyword of keywords) {
                        if (name.includes(keyword)) {
                            return category;
                        }
                    }
                }
                
                return 'outros';
            }

            function formatCurrency(value) {
                return `R$ ${value.toFixed(2).replace('.', ',')}`;
            }

            function saveList() {
                localStorage.setItem('shoppingList', JSON.stringify(shoppingList));
                // Fazer backup autom√°tico
                localStorage.setItem('shoppingListBackup_' + new Date().toISOString().slice(0,10), JSON.stringify(shoppingList));
            }

            // ========== INICIALIZAR APLICA√á√ÉO ==========
            function initApp() {
                renderList();
                updateStats();
                productName.focus();
                
                // Verificar se √© a primeira visita
                if (!localStorage.getItem('appInitialized')) {
                    setTimeout(() => {
                        showHelp();
                    }, 1000);
                    localStorage.setItem('appInitialized', 'true');
                }
            }

            // ========== RENDERIZAR LISTA ==========
            function renderList() {
                listBody.innerHTML = '';
                
                if (shoppingList.length === 0) {
                    listBody.innerHTML = `
                        <tr class="empty-row">
                            <td colspan="5">Sua lista est√° vazia. Adicione produtos para come√ßar!</td>
                        </tr>
                    `;
                    return;
                }
                
                // Ordenar por data (mais recente primeiro)
                shoppingList.sort((a, b) => new Date(b.date) - new Date(a.date));
                
                shoppingList.forEach(product => {
                    const total = product.quantity * product.price;
                    const date = new Date(product.date);
                    const formattedDate = date.toLocaleDateString('pt-BR', { 
                        day: '2-digit', 
                        month: '2-digit',
                        hour: '2-digit',
                        minute: '2-digit'
                    });
                    
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>
                            <div style="font-weight: 600;">${product.name}</div>
                            <div style="font-size: 0.85rem; color: #666; margin-top: 5px;">
                                <i class="fas fa-calendar"></i> ${formattedDate}
                                ${product.category ? `<span style="margin-left: 10px; background: #e0e7ff; color: #4b6cb7; padding: 2px 8px; border-radius: 10px; font-size: 0.8rem;">${getCategoryName(product.category)}</span>` : ''}
                            </div>
                        </td>
                        <td>${product.quantity}</td>
                        <td>${formatCurrency(product.price)}</td>
                        <td><strong style="color: #182848;">${formatCurrency(total)}</strong></td>
                        <td>
                            <div class="action-buttons">
                                <button class="btn-edit" onclick="editProduct(${product.id})">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn-delete" onclick="deleteProduct(${product.id})">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    `;
                    
                    listBody.appendChild(row);
                });
            }

            function getCategoryName(categoryKey) {
                const categories = {
                    'alimentacao': 'Alimenta√ß√£o',
                    'limpeza': 'Limpeza',
                    'higiene': 'Higiene',
                    'bebidas': 'Bebidas',
                    'mercearia': 'Mercearia',
                    'outros': 'Outros'
                };
                return categories[categoryKey] || categoryKey;
            }

            // ========== ATUALIZAR ESTAT√çSTICAS ==========
            function updateStats() {
                if (shoppingList.length === 0) {
                    totalSpentElement.textContent = 'R$ 0,00';
                    highestSpentElement.textContent = 'R$ 0,00';
                    lowestSpentElement.textContent = 'R$ 0,00';
                    itemCountElement.textContent = '0';
                    return;
                }
                
                const totals = shoppingList.map(product => product.quantity * product.price);
                const totalSpent = totals.reduce((sum, current) => sum + current, 0);
                const highestSpent = Math.max(...totals);
                const lowestSpent = Math.min(...totals);
                
                totalSpentElement.textContent = formatCurrency(totalSpent);
                highestSpentElement.textContent = formatCurrency(highestSpent);
                lowestSpentElement.textContent = formatCurrency(lowestSpent);
                itemCountElement.textContent = shoppingList.length.toString();
            }

            // ========== ADICIONAR PRODUTO ==========
            productForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                // Mostrar loading
                const originalText = submitBtn.innerHTML;
                submitBtn.innerHTML = '<div class="loading"></div> Adicionando...';
                submitBtn.disabled = true;
                
                setTimeout(() => {
                    const product = {
                        id: Date.now(),
                        name: productName.value.trim(),
                        quantity: parseInt(productQuantity.value),
                        price: parseFloat(productPrice.value),
                        category: productCategory.value || autoCategorizeProduct(productName.value),
                        date: new Date().toISOString()
                    };
                    
                    // Valida√ß√£o
                    if (!product.name || product.quantity <= 0 || product.price <= 0) {
                        alert('Por favor, preencher todos os campos corretamente.');
                        submitBtn.innerHTML = originalText;
                        submitBtn.disabled = false;
                        return;
                    }
                    
                    shoppingList.push(product);
                    saveList();
                    renderList();
                    updateStats();
                    
                    // Feedback visual
                    productName.value = '';
                    productQuantity.value = 1;
                    productPrice.value = '';
                    productCategory.value = '';
                    productName.focus();
                    
                    // Restaurar bot√£o
                    submitBtn.innerHTML = originalText;
                    submitBtn.disabled = false;
                    
                    // Feedback de sucesso
                    showNotification('Produto adicionado com sucesso!', 'success');
                    
                }, 500);
            });

            // ========== EDITAR PRODUTO ==========
            window.editProduct = function(id) {
                const product = shoppingList.find(item => item.id === id);
                
                if (!product) return;
                
                productName.value = product.name;
                productQuantity.value = product.quantity;
                productPrice.value = product.price;
                productCategory.value = product.category;
                
                shoppingList = shoppingList.filter(item => item.id !== id);
                saveList();
                renderList();
                updateStats();
                
                productName.focus();
                showNotification('Produto carregado para edi√ß√£o', 'info');
            };

            // ========== EXCLUIR PRODUTO ==========
            window.deleteProduct = function(id) {
                if (confirm('Tem certeza que deseja remover este item da lista?')) {
                    shoppingList = shoppingList.filter(item => item.id !== id);
                    saveList();
                    renderList();
                    updateStats();
                    showNotification('Produto removido com sucesso!', 'warning');
                }
            };

            // ========== LIMPAR TUDO ==========
            clearAllButton.addEventListener('click', function() {
                if (shoppingList.length === 0) {
                    alert('A lista j√° est√° vazia!');
                    return;
                }
                
                if (confirm('Tem certeza que deseja limpar TODOS os itens da lista? Esta a√ß√£o n√£o pode ser desfeita.')) {
                    // Fazer backup antes de limpar
                    localStorage.setItem('shoppingListBackup_deleted', JSON.stringify(shoppingList));
                    
                    shoppingList = [];
                    saveList();
                    renderList();
                    updateStats();
                    showNotification('Lista limpa com sucesso!', 'warning');
                }
            });

            // ========== EXPORTAR LISTA ==========
            exportButton.addEventListener('click', function() {
                if (shoppingList.length === 0) {
                    alert('A lista est√° vazia. N√£o h√° nada para exportar.');
                    return;
                }
                
                const exportData = {
                    shoppingList: shoppingList,
                    exportDate: new Date().toISOString(),
                    totalItems: shoppingList.length,
                    totalValue: shoppingList.reduce((sum, item) => sum + (item.quantity * item.price), 0)
                };
                
                const dataStr = JSON.stringify(exportData, null, 2);
                const dataUri = 'data:application/json;charset=utf-8,' + encodeURIComponent(dataStr);
                
                const exportFileName = `lista-compras-${new Date().toISOString().slice(0,10)}.json`;
                
                const linkElement = document.createElement('a');
                linkElement.setAttribute('href', dataUri);
                linkElement.setAttribute('download', exportFileName);
                linkElement.click();
                
                showNotification(`Lista exportada com ${shoppingList.length} itens!`, 'success');
            });

            // ========== IMPORTAR LISTA ==========
            importButton.addEventListener('click', function() {
                importFile.click();
            });

            importFile.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = function(event) {
                    try {
                        const importedData = JSON.parse(event.target.result);
                        let importedList = importedData;
                        
                        if (importedData.shoppingList) {
                            importedList = importedData.shoppingList;
                        }
                        
                        if (!Array.isArray(importedList)) {
                            throw new Error('Formato inv√°lido');
                        }
                        
                        if (confirm(`Deseja importar ${importedList.length} itens? A lista atual ser√° substitu√≠da.`)) {
                            shoppingList = importedList.map(item => ({
                                ...item,
                                id: item.id || Date.now() + Math.random(),
                                date: item.date || new Date().toISOString(),
                                category: item.category || autoCategorizeProduct(item.name)
                            }));
                            
                            saveList();
                            renderList();
                            updateStats();
                            showNotification(`Lista importada com ${importedList.length} itens!`, 'success');
                        }
                    } catch (error) {
                        alert('Erro ao importar arquivo. Certifique-se de que √© um arquivo JSON v√°lido.');
                        console.error('Erro na importa√ß√£o:', error);
                    }
                    
                    importFile.value = '';
                };
                
                reader.readAsText(file);
            });

            // ========== BACKUP E RESTAURA√á√ÉO ==========
            backupLink.addEventListener('click', function(e) {
                e.preventDefault();
                
                if (shoppingList.length === 0) {
                    alert('N√£o h√° dados para fazer backup.');
                    return;
                }
                
                const backupData = {
                    shoppingList: shoppingList,
                    backupDate: new Date().toISOString()
                };
                
                const backupKey = 'manualBackup_' + new Date().toISOString();
                localStorage.setItem(backupKey, JSON.stringify(backupData));
                
                alert(`Backup realizado com sucesso!\n${shoppingList.length} itens salvos.\n\nChave do backup: ${backupKey}`);
            });

            restoreLink.addEventListener('click', function(e) {
                e.preventDefault();
                
                // Listar todos os backups dispon√≠veis
                const backups = [];
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    if (key.includes('Backup') || key.includes('backup')) {
                        try {
                            const data = JSON.parse(localStorage.getItem(key));
                            if (data && Array.isArray(data.shoppingList)) {
                                backups.push({
                                    key: key,
                                    date: data.backupDate || key,
                                    count: data.shoppingList.length
                                });
                            }
                        } catch (e) {
                            // Ignorar chaves que n√£o s√£o backups
                        }
                    }
                }
                
                if (backups.length === 0) {
                    alert('Nenhum backup encontrado.');
                    return;
                }
                
                const backupList = backups.map(b => 
                    `${new Date(b.date).toLocaleString()} - ${b.count} itens`
                ).join('\n');
                
                const backupKey = prompt(
                    `Backups dispon√≠veis:\n\n${backupList}\n\nDigite a data do backup que deseja restaurar:`,
                    backups[0].date
                );
                
                if (backupKey) {
                    const selectedBackup = backups.find(b => b.date.includes(backupKey));
                    if (selectedBackup) {
                        const data = JSON.parse(localStorage.getItem(selectedBackup.key));
                        if (confirm(`Restaurar backup com ${data.shoppingList.length} itens?`)) {
                            shoppingList = data.shoppingList;
                            saveList();
                            renderList();
                            updateStats();
                            showNotification('Backup restaurado com sucesso!', 'success');
                        }
                    } else {
                        alert('Backup n√£o encontrado.');
                    }
                }
            });

            // ========== AJUDA ==========
            helpLink.addEventListener('click', function(e) {
                e.preventDefault();
                showHelp();
            });

            function showHelp() {
                const helpText = `
LISTA DE COMPRAS INTELIGENTE - AJUDA

üìã FUNCIONALIDADES PRINCIPAIS:
1. Adicionar produtos com nome, quantidade e valor
2. Visualizar estat√≠sticas autom√°ticas de gastos
3. Ver onde voc√™ gasta mais e menos
4. Exportar/importar sua lista
5. Dashboard completo de gastos mensais

üéØ COMO USAR:
‚Ä¢ Preencha os campos e clique em "Adicionar √† Lista"
‚Ä¢ Clique no √≠cone de edi√ß√£o para modificar um produto
‚Ä¢ Clique no √≠cone de lixeira para remover um produto
‚Ä¢ Use o Dashboard para ver gr√°ficos e an√°lises

üíæ SEUS DADOS:
‚Ä¢ S√£o salvos automaticamente no seu navegador
‚Ä¢ N√£o s√£o enviados para servidores externos
‚Ä¢ Voc√™ pode fazer backup manualmente

üìä DASHBOARD:
‚Ä¢ Clique em "Ver Dashboard de Gastos"
‚Ä¢ Visualize gr√°ficos mensais
‚Ä¢ Veja categorias de gastos
‚Ä¢ Compare meses e anos

üîß DICAS:
‚Ä¢ Use categorias para organizar melhor
‚Ä¢ Exporte sua lista regularmente
‚Ä¢ Compare pre√ßos antes de comprar
                `;
                
                alert(helpText);
            }

            // ========== NOTIFICA√á√ïES ==========
            function showNotification(message, type = 'info') {
                // Remover notifica√ß√£o anterior se existir
                const existingNotification = document.querySelector('.notification');
                if (existingNotification) {
                    existingNotification.remove();
                }
                
                const notification = document.createElement('div');
                notification.className = `notification notification-${type}`;
                notification.innerHTML = `
                    <div style="position: fixed; top: 20px; right: 20px; background: ${type === 'success' ? '#51cf66' : type === 'warning' ? '#ff6b6b' : '#4b6cb7'}; color: white; padding: 15px 25px; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.2); z-index: 1000; display: flex; align-items: center; gap: 10px; animation: slideIn 0.3s ease-out;">
                        <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'warning' ? 'exclamation-triangle' : 'info-circle'}"></i>
                        ${message}
                    </div>
                `;
                
                document.body.appendChild(notification);
                
                // Remover ap√≥s 3 segundos
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.style.animation = 'slideOut 0.3s ease-out';
                        setTimeout(() => {
                            if (notification.parentNode) {
                                notification.remove();
                            }
                        }, 300);
                    }
                }, 3000);
                
                // Adicionar estilos de anima√ß√£o se n√£o existirem
                if (!document.querySelector('#notification-styles')) {
                    const style = document.createElement('style');
                    style.id = 'notification-styles';
                    style.textContent = `
                        @keyframes slideIn {
                            from { transform: translateX(100%); opacity: 0; }
                            to { transform: translateX(0); opacity: 1; }
                        }
                        @keyframes slideOut {
                            from { transform: translateX(0); opacity: 1; }
                            to { transform: translateX(100%); opacity: 0; }
                        }
                    `;
                    document.head.appendChild(style);
                }
            }

            // ========== INICIALIZAR ==========
            initApp();
            
            // Adicionar dados de exemplo na primeira execu√ß√£o
            if (shoppingList.length === 0 && !localStorage.getItem('sampleDataAdded')) {
                setTimeout(() => {
                    if (confirm('Deseja adicionar dados de exemplo para testar o sistema?')) {
                        addSampleData();
                        localStorage.setItem('sampleDataAdded', 'true');
                    }
                }, 2000);
            }
            
            function addSampleData() {
                const sampleProducts = [
                    { name: 'Arroz Integral', quantity: 2, price: 28.90, category: 'alimentacao' },
                    { name: 'Feij√£o Carioca', quantity: 3, price: 9.50, category: 'alimentacao' },
                    { name: 'Macarr√£o Espaguete', quantity: 4, price: 5.30, category: 'alimentacao' },
                    { name: 'Carne Bovina (kg)', quantity: 2, price: 45.90, category: 'alimentacao' },
                    { name: 'Peito de Frango (kg)', quantity: 3, price: 22.75, category: 'alimentacao' },
                    { name: 'Leite Integral (L)', quantity: 6, price: 5.90, category: 'alimentacao' },
                    { name: 'Ovos (d√∫zia)', quantity: 1, price: 14.90, category: 'alimentacao' },
                    { name: 'Sab√£o em P√≥ (kg)', quantity: 1, price: 26.90, category: 'limpeza' },
                    { name: 'Detergente L√≠quido', quantity: 2, price: 4.50, category: 'limpeza' },
                    { name: 'Shampoo Anticaspa', quantity: 1, price: 24.90, category: 'higiene' },
                    { name: 'Creme Dental', quantity: 2, price: 8.80, category: 'higiene' },
                    { name: 'Refrigerante (2L)', quantity: 3, price: 8.90, category: 'bebidas' },
                    { name: '√Ågua Mineral (garrafa)', quantity: 12, price: 2.50, category: 'bebidas' }
                ];
                
                const today = new Date();
                
                sampleProducts.forEach((product, index) => {
                    const purchaseDate = new Date(today);
                    purchaseDate.setDate(purchaseDate.getDate() - Math.floor(Math.random() * 30));
                    
                    shoppingList.push({
                        id: Date.now() + index,
                        name: product.name,
                        quantity: product.quantity,
                        price: product.price,
                        category: product.category,
                        date: purchaseDate.toISOString()
                    });
                });
                
                saveList();
                renderList();
                updateStats();
                showNotification('Dados de exemplo adicionados!', 'success');
            }
            
            // ========== ATALHOS DE TECLADO ==========
            document.addEventListener('keydown', function(e) {
                // Ctrl+S para salvar (exportar)
                if (e.ctrlKey && e.key === 's') {
                    e.preventDefault();
                    exportButton.click();
                }
                
                // Ctrl+L para limpar foco
                if (e.ctrlKey && e.key === 'l') {
                    e.preventDefault();
                    productName.focus();
                }
                
                // Escape para limpar formul√°rio
                if (e.key === 'Escape') {
                    if (document.activeElement === productName || 
                        document.activeElement === productQuantity || 
                        document.activeElement === productPrice) {
                        productForm.reset();
                        productQuantity.value = 1;
                    }
                }
            });
            
            // ========== AUTO-SAVE ==========
            setInterval(() => {
                if (shoppingList.length > 0) {
                    saveList();
                    // Salvar apenas no console para debug
                    console.log(`Auto-save: ${shoppingList.length} itens salvos`);
                }
            }, 30000); // Salvar a cada 30 segundos
            
        });
    </script>
</body>
</html>
